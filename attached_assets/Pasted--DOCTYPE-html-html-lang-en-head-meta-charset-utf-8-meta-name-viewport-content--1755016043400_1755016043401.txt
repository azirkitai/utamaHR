<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Payslip Template (HQ Layout)</title>
  <style>
    /* ===== PAGE & BASE ===== */
    @page { size: A4; margin: 18mm; }
    html, body { margin: 0; padding: 0; }
    body { font-family: Inter, Roboto, Arial, sans-serif; color:#111827; font-size:12px; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .muted { color:#6B7280; }
    .small { font-size: 10px; }
    .bold { font-weight:700; }
    .right { text-align:right; }
    .mb-6 { margin-bottom: 24px; }
    .mb-4 { margin-bottom: 16px; }
    .mb-3 { margin-bottom: 12px; }
    .mb-2 { margin-bottom: 8px; }
    .mt-2 { margin-top: 8px; }

    /* ===== HEADER ===== */
    .confidential { font-size:10px; text-transform:uppercase; float:right; }
    .company-name { font-weight:700; font-size:18px; }
    .company-reg { margin-top: 2px; }
    .company-addr { margin-top: 2px; line-height: 1.35; }

    /* ===== PANELS & TABLES ===== */
    .panel { border:1px solid #E5E7EB; border-radius:8px; padding:12px; }
    .row { display:flex; gap:16px; }
    .col { flex:1; }

    .kv { display:flex; gap:8px; margin: 2px 0; }
    .kv .k { width: 90px; color:#6B7280; }
    .kv .v { flex: 1; font-weight:600; }

    .twocol { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    .tbl { border:1px solid #E5E7EB; border-radius:8px; overflow: hidden; }
    .tbl .hd { background:#F9FAFB; padding:10px 12px; font-weight:700; border-bottom:1px solid #E5E7EB; }
    .tbl .rowi { display:flex; justify-content:space-between; align-items:center; padding:8px 12px; }
    .tbl .sep { border-top:1px solid #E5E7EB; margin-top:4px; padding-top:8px; font-weight:700; }
    .money { text-align:right; min-width: 120px; }

    .net { margin-top:12px; padding:12px; border:1px solid #E5E7EB; border-radius:8px; font-weight:800; font-size:16px; display:flex; justify-content:space-between; }

    .grid3 { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px; }
    .section-title { color:#6B7280; font-weight:700; margin:14px 0 6px; }
    .hr { border-top:1px solid #E5E7EB; margin:12px 0; }

    /* Print friendly adjustments */
    @media print {
      .no-print { display:none !important; }
    }
  </style>
</head>
<body>

  <!-- ===== HEADER (follow HQ layout) ===== -->
  <div class="confidential">STRICTLY PRIVATE &amp; CONFIDENTIAL</div>
  <div class="company-name">{{company.name}}</div>
  <div class="company-reg">{{company.regNo}}</div>
  <div class="company-addr">{{company.address1}}<br/>{{company.address2}}</div>

  <!-- ===== EMPLOYEE / PERIOD PANEL ===== -->
  <div class="panel mb-4 mt-2">
    <div class="row">
      <div class="col">
        <div class="kv"><div class="k">NAME:</div><div class="v">{{employee.name}}</div></div>
        <div class="kv"><div class="k">I/C NO.:</div><div class="v">{{employee.icNo}}</div></div>
        <div class="kv"><div class="k">POSITION:</div><div class="v">{{employee.position}}</div></div>
      </div>
      <div class="col">
        <div class="kv"><div class="k">MONTH:</div><div class="v">{{period.month}}</div></div>
        <div class="kv"><div class="k">YEAR:</div><div class="v">{{period.year}}</div></div>
      </div>
    </div>
  </div>

  <!-- ===== INCOME vs DEDUCTIONS ===== -->
  <div class="twocol">
    <!-- INCOME -->
    <div class="tbl">
      <div class="hd">INCOME</div>
      <div class="rowi"><div>BASIC SALARY</div><div class="money">RM {{income.basic}}</div></div>
      <div class="rowi"><div>FIXED ALLOWANCE</div><div class="money">RM {{income.fixedAllowance}}</div></div>

      <!-- Optional extra income rows (render only if > 0) -->
      <!--INCOME_ITEMS_START-->
      <!--
      <div class="rowi"><div>{{item.label}}</div><div class="money">RM {{item.amount}}</div></div>
      (Duplicate per item where amount > 0)
      -->
      <!--INCOME_ITEMS_END-->

      <div class="rowi sep"><div>TOTAL GROSS INCOME</div><div class="money">RM {{income.totalGross}}</div></div>
    </div>

    <!-- DEDUCTIONS -->
    <div class="tbl">
      <div class="hd">DEDUCTIONS</div>
      <div class="rowi"><div>EPF</div><div class="money">RM {{deduction.epfEmp}}</div></div>
      <div class="rowi"><div>SOCSO</div><div class="money">RM {{deduction.socsoEmp}}</div></div>
      <div class="rowi"><div>EIS</div><div class="money">RM {{deduction.eisEmp}}</div></div>

      <!-- Optional extra deduction rows (render only if > 0) -->
      <!--DEDUCTION_ITEMS_START-->
      <!--
      <div class="rowi"><div>{{item.label}}</div><div class="money">RM {{item.amount}}</div></div>
      (Duplicate per item where amount > 0, e.g., PCB38, PCB39, ZAKAT, OTHERS)
      -->
      <!--DEDUCTION_ITEMS_END-->

      <div class="rowi sep"><div>TOTAL DEDUCTIONS</div><div class="money">RM {{deduction.total}}</div></div>
    </div>
  </div>

  <!-- NET INCOME -->
  <div class="net">
    <div>NET INCOME</div>
    <div class="money">RM {{netIncome}}</div>
  </div>

  <!-- EMPLOYER CONTRIBUTION -->
  <div class="section-title">CURRENT MONTH EMPLOYER CONTRIBUTION</div>
  <div class="grid3">
    <div class="panel"><div>EPF</div><div class="money">RM {{employerContrib.epfEr}}</div></div>
    <div class="panel"><div>SOCSO</div><div class="money">RM {{employerContrib.socsoEr}}</div></div>
    <div class="panel"><div>EIS</div><div class="money">RM {{employerContrib.eisEr}}</div></div>
  </div>

  <div class="hr"></div>
  <div>YTD EMPLOYEE CONTRIBUTION: <b>RM {{ytd.employee}}</b> &nbsp;&nbsp;|&nbsp;&nbsp; YTD EMPLOYER CONTRIBUTION: <b>RM {{ytd.employer}}</b></div>
  <div>MTD: <b>RM {{ytd.mtd}}</b></div>

  <!-- ===== HOW TO USE (dev-only helper, not printed by Puppeteer if you strip it) ===== -->
  <div class="no-print muted small mt-2">
    <hr>
    <b>Dev Notes:</b>
    <ol>
      <li>Find & replace all <code>{{placeholders}}</code> with runtime values before rendering.</li>
      <li>Repeat the block between <code>INCOME_ITEMS_START/END</code> and <code>DEDUCTION_ITEMS_START/END</code> per item where amount &gt; 0.</li>
      <li>Render to PDF with Puppeteer:<br>
        <pre>
const puppeteer = require('puppeteer');
const fs = require('fs');
const path = require('path');

async function generatePayslipPDF(htmlString, outPath) {
  const browser = await puppeteer.launch({ headless: 'new' });
  const page = await browser.newPage();
  await page.setContent(htmlString, { waitUntil: 'load' });
  await page.pdf({
    path: outPath,
    format: 'A4',
    printBackground: true,
    margin: { top: '18mm', right: '18mm', bottom: '18mm', left: '18mm' }
  });
  await browser.close();
}
        </pre>
      </li>
      <li>Money format: ensure two decimals and thousands separators on injection.</li>
    </ol>
  </div>
</body>
</html>
